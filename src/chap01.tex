\chapter{Endgames: Perfect Situation in~Perfect-Information Games}

For many games, solving their late stages (so-called \emph{endgames}) can be done in~an~online way.
In other words, we are often able to postpone the computation of~the endgame strategy until the endgame itself is reached in~the play.

This is especially the case of~perfect-information games such as chess or Go, where the endgame technique has been used for long time.
In these domains, online endgame solving has~significant importance, as it substantially improves the playing quality of~agents.

\section{Chess Endgames}
\todo

\section{Go Endgames}
\todo

\subsection{Why Focus on Go Endgames?}

Martin~\Mueller (in~his dissertation~\cite{Muller1995computer}) mentions the following advantages of~Go endgames for research:
\begin{itemize}
  \item The complexity of~the game often decreases towards the end.
    This allows the study of~Go in a~controlled, simplified context.
  \item An~exact solution is possible for some classes of~endgame positions.
  \item The exact solution of~parts of~a~Go board facilitates the analysis of the rest.
    Reaching the ultimate goal of~winning the game is easier when complete information about part of~the game is at~hand.
    Such information is useful as~additional input for the heuristics that deal with the rest of~the board.

    Human experts use similar reasoning: they observe the score continually from the early midgame, and base their strategic decisions on~such an~analysis (\cite{Takagawa85}).
  \item Some methods developed for partitioning, searching and scoring during endgame carry over to the midgame and opening.
    As programs improve, fewer game-deciding blunders will occur, so the importance of~endgame-type calculation is bound to~increase.
  \item On~a~more philosophical note, the endgame relates to the full game of~Go similarly as Go relates to~real world AI problems.
    It provides a~simplified, more controlled sub-domain that allows the use of~stronger theoretical models than the larger, more general problem.
\end{itemize}

\subsection{Partitioning an~Endgame into Local (Sub)games}

According to~(\cite{Muller1995computer}), there are very strong reasons to~partition board positions during endgames in~Go:
\begin{quotation}
  A~Go position usually consists of~several local scenes that can be analyzed individually.
  In the opening, these scenes can be far apart, and their influence on~each other may be weak.
  A~better partition occurs late in the game, when there are walls of~stones dividing the board.
  A~move cannot have any influence across a~wall of~safe stones.

  \begin{figure}[H]
    \centering
    \includegraphics[width=.4\textwidth]{../img/late_endgame_Go_position_suited_for_exact_analysis.png}
    \caption{Late endgame position suited for exact analysis}
    \label{fig:late-Go-endgame}
  \end{figure}

  Board partition improves when many safe walls are on~the board.
  In the opening and midgame, any partition can be approximate at best.
  In the endgame, the partition gets more precise when the status of~all big groups has been settled, and the outlines of~territories are clear.
  When stones become ``immortal'', significant parts of~the board definitely belong to one of the players.
  The connected components of~the rest of~the board form local games that are independent from each other.

  If each local game is simple enough to~analyze completely (such as in Figure~\ref{fig:late-Go-endgame}), combinatorial game theory can compute an~optimal move for the full board position.
\end{quotation}

\subsection{Playing Computer Go as a~Sum of~Local Games}

This is the general procedure for playing Go as a~sum of~local games used in~(\cite{Muller1995computer}):
\begin{enumerate}
  \item Board partition: find safe blocks, safe territories, and local areas.
  \item Generate local game trees in each area.
  \item Evaluate local terminal positions.
  \item Transform local game trees into mathematical games (and simplify games).
  \item Find an optimal move in the sum game and play it.
\end{enumerate}
\Mueller proposes heuristic algorithms for playing the entire game, and exact algorithms for late endgame positions.
Thus, the task of~solving endgames in 1995---at the age of Computer Go's infancy---already played a~vital role.

\subsection{A~Combinatorial Game Theory Framework for Approximate Play of~Sum Games}

\Mueller also suggests to replace the ``standard model'' of~computer Go by a~sum game model.
The following benefits and problems of~the sum game model for computer Go are listed in~(\cite{Muller1995computer}):

\medskip

\underline{Benefits}
\begin{itemize}[+]
  \item The model is well suited to the knowledge and style of~\textit{(at that time)} current Go programs:
    they concentrate on local fighting and surrounding territories.
  \item Locality reduces the complexity of~move generation and position evaluation.
    With the emphasis on~evaluation, clever pruning during move generation is not as crucial as in~global search because of~the reduced search space.
  \item Stepwise, directed expansion of~search is supported.
    This provides more time control than the usual iterative deepening.
    It is easy to use opponent's time.
  \item Important Go terms can be expressed or~refined in terms of~the theory, and need not be programmed separately.
  \item The reuse of~local game analysis improves efficiency while playing a~game.
  \item Parallelism emerges naturally on~many levels: local searches are independent, evaluation and operations on mathematical games can be parallelized.
\end{itemize}

\underline{Problems}
\begin{itemize}[-]
  \item Managing incrementally changing sets of~local graphs in place of a single position adds complexity.
  \item Accurate board partition and recognition of~dependencies is crucial.
  \item The usual problems of~selective search appear in complicated local games:
    missing crucial moves leads to wrong evaluation.
  \item Non-constant local games may be overlooked completely, such as insecure ``territories'' which can be destroyed from the inside.
  \item In this model there is no concept of~long-range full board plans.
    This is probably not a~big issue until programs reach amateur Dan or even professional level \textit{(for an~update on the current situation, see Subsection~\ref{ssec:AlphaGo})}.
\end{itemize}

\subsection{A~Sum Game Model for the Entire Game of~Go}

Citing~(\cite{Muller1995computer}), there are several obstacles of~heuristic board partition (in the sum game model).

\begin{itemize}[(a)]
  \item the impossibility of a~perfect, precise split:
    \begin{quotation}
      When applying a~local game model to the opening or~midgame, the biggest obstacle is the fact that the board cannot be partitioned into independent subgames.
      Few areas are completely surrounded, and surrounding stones are not yet invulnerable.
      We develop heuristics for board partition that split the imperfectly surrounded areas of~the opening and midgame.
    \end{quotation}

  \item the dependencies between the resulting subgames: 
    \begin{quotation}
      An~unavoidable side effect of~heuristic partition are dependencies between the resulting local games.
      Simple strategies for dealing with dependencies are pretending the games are independent, or re-searching a~bigger merged game.
    \end{quotation}
\end{itemize}


\subsection{AlphaGo}
\label{ssec:AlphaGo}
\todo
