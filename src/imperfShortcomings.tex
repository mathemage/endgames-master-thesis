\chapter{Shortcomings of~the Imperfect Information for Subgames}
\label{ch:imperf-shortcomings}
\epigraphLong{
  Our shortcomings are the eyes with which we see the ideal.
}{Friedrich Nietzsche}
In this chapter we will notice how the situation for subgames becomes more delicate within the imperfect-information setting.
A~re-solved subgame strategy can end up being more exploitable:
even if we play a~\acrfull{br} in the subgame, we \textbf{assume the fixed original strategy} in~the trunk of~the game tree.

This is, however, not true since the opponent can distinguish the states within our own information set, which---for us---are indistinguishable.
He can therefore freely change his behavior in~the trunk and manipulate against our \acrlong{br} for his own benefit.
For more illustration, study the example in Section~\ref{sec:intricate-ex} (taken from \cite{BurchJohansonBowling2014}).

\section{An~Intricate Example}
\label{sec:intricate-ex}
\epigraphLong{
  It's very simple.
  Scissors cuts paper.
  Paper covers rock.
  Rock crushes lizard.
  Lizard poisons Spock.
  Spock smashes scissors.
  Scissors decapitates lizard.
  Lizard eats paper.
  Paper disproves Spock.
  Spock vaporizes rock.
  And as it always has, rock crushes scissors.
}{Sheldon Cooper (\emph{The Big Bang Theory}), Season~2, Episode~8}
To see the difficulties of~combining a~re-solved subgame strategy with an~original trunk strategy, we will consider \emph{\acrshort{rps}} as our running example:
\begin{figure}[H]
  \centering
  \scriptsize
  \def\svgwidth{.45\textwidth}
  \input{../img/rock-paper-scissors-ext-form.pdf_tex}
  \def\captionTitle{Extensive form of~\acrshort{rps}}
  \caption[\captionTitle]{\captionTitle: Scissors cuts paper. Paper covers rock. Rock crushes scissors. (\cite{Ganzfried2015endgame, BurchJohansonBowling2014})}
  \label{fig:game-tree-rock-paper-scissors}
\end{figure}

Figure~\ref{fig:game-tree-rock-paper-scissors} displays the extensive form of~\acrshort{rps}:
rather than showing the choices simultaneously, the two players take turns in~picking their action.
However, their decisions are mutually hidden, and revealed only at~the end.

The blue ``bubble'' encircling the 3 acting nodes of player~$2$ marks his (only) information set $\I_2 = \{2_R, 2_P, 2_S\}$, where states correspond to the action chosen by~the first player.
This imperfect information represents the fact that he is unaware of~1's preceding choice.

\section{Na{\"i}ve Re-solving of~Rock-Paper-Scissors}
\label{sec:naive-rps-subgame}
\epigraphLong{
  Every mathematical discipline goes through three periods of development:
  the na{\"i}ve, the formal, and the critical.
}{David Hilbert}
One apparent subgame (recall Definition~\ref{defn:subgame}) of~\acrshort{rps} is the endgame when player~$2$ picks his choice:
\begin{figure}[H]
  \centering
  \scriptsize
  \def\svgwidth{.25\textwidth}
  \input{../img/rock-paper-scissors-subgame.pdf_tex}
  \def\captionTitle{An~(imperfect-information) subgame~$S$ of~\acrshort{rps}}
  \captionWithCite{\captionTitle}{BurchJohansonBowling2014}
  \label{fig:subgame-rock-paper-scissors}
\end{figure}
\noindent
At the beginning of~subgame~$S$, player~$2$ resides in~one of~the three states $\I_2 = \{2_R, 2_P, 2_S\}$ depending on~opponent's strategy in the (removed) trunk.
Specifically, the probability of~being in state~$2_R$ equals to 1's probability to~choose rock, and likewise for states $2_P$ and $2_S$.
The three augmented information sets of~player~$1$ (Definition~\ref{defn:augm-info-set}) are $ \I_1^R = \{2_R\}$, $\I_1^P = \{2_P\}$ and $\I_1^S = \{2_S\}$.

It is not enough to~na{\"i}vely re-solve subgame~$S$ with the~assumption of~a~fixed strategy in the trunk:
\begin{claim}[\cite{Ganzfried2015endgame}, Proposition~1; \cite{BurchJohansonBowling2014}]
  \label{claim:rps-subgame}
  If subgame $S$ is re-solved with a~fixed trunk strategy, there is an~equilibristic solution (i.e., a~\acrlong{br} against the fixed trunk strategy) that player~$1$ can exploit, once he is allowed to adjust his strategy in the trunk.
\end{claim}
\begin{proof}
  Suppose the initial strategy $\sigma = (\sigma_1, \sigma_2)$ is uniformly random\footnotemark{}.
  Evidently, $\sigma$ is an~equilibrium for the full game of~\acrshort{rps}.
  \footnotetext{Every move is selected with the same probability $\frac{1}{3}$.}

  Now, if we discard the trunk and assume the fixed trunk strategy~$\sigma_1$, player~$2$ is to be in~any of~the states $\I_2 = \{2_R, 2_P, 2_S\}$ with the equal probability.
  Because of~this, each action results in the same expected utility of~$0$ (e.g., playing rock gives utility $\frac{1}{3} \cdot 0 + \frac{1}{3} \cdot (-1) + \frac{1}{3} \cdot 1 = 0$).
  Hence, it is irrelevant for which strategy player~$2$ decides, as all strategies produce equally good utilities, and thus, all are \acrshort{br}s to $1$'s strategy\footnotemark.
  \footnotetext{Player~$1$ has only one possibility, the empty strategy, since he takes no action in subgame~$S$.}

  Player~$2$ can opt for a~strategy~$\sigma^R_2$ of~\emph{always playing rock}, as it is a~valid \acrshort{br}.
  This would become the equilibristic solution from the statement.
  If player~$1$ can change his strategy in~the trunk, though, he may naturally exploit the equilibristic solution of~player~$2$.
  Namely, a~strategy~$\sigma^P_1$ of~\emph{always playing paper} certainly defeats $\sigma^R_2$.
\end{proof}

\begin{cor}
  Even in a~two-player zero-sum game with a~unique equilibrium and a~single subgame, the trunk strategy and the re-solved (even optimal) subgame strategy can fail to merge into a~full-game equilibrium.
\end{cor}

%Thus, \acrshort{rps} is an~imperfect-information counterexample to Theorem~\ref{thm:perf-info-subgames-utility} (p.~\pageref{thm:perf-info-subgames-utility}).

\section{A~New Hope for Subgames with Imperfect Information}
\epigraphLong{
  Help me, Obi-Wan Kenobi; you're my only hope.
}{Princess Leia (\emph{Star Wars: Episode IV -- A New Hope})}
The dismal example of~\acrshort{rps} shows the obstacles of~na{\"i}vely using the same approach as~with the perfect-information case.
Solving subgames separately thus appear as an~impossible mission. 

However, in the following chapters we will look into two recent techniques, which deal with imperfect-information subgames in a~promising way:
\begin{enumerate}[(i)]
  \item endgame solving (\cite{Ganzfried2015endgame}) in Chapter~\ref{ch:endgame-solving}
  \item \acrshort{cfr-d} and decomposition (\cite{BurchJohansonBowling2014}) in Chapter~\ref{ch:cfr-d}
\end{enumerate}
We also re-state both of~them using equivalent \acrshort{lp} formulations.
Treating these techniques as~optimization problems will help to reveal their underlying features.

Finally in Chapter~\ref{ch:max-margin}, we use these insights to~motivate our own, new technique: \emph{subgame-margin maximization} (\cite{Moravcik2016refining}).
